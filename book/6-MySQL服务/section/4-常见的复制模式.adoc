=== 常见的复制模式

本节内容摘录自 http://www.mysql.com/why-mysql/white-papers/wp-mysql-5-5-replication-zh[《MySQL Replication(复制) - 用MySQL5.5提高可扩展性和可用性》]

MySQL支持多种不同的复制拓扑。

image::image/4-常见的MySQL复制拓扑.jpg[caption="Figure 1: ", title="常见的MySQL复制拓扑", alt="常见的MySQL复制拓扑"]

==== 主从

这是最常见的也是最易于配置和管理的拓扑形式。在这种拓扑下我们有两台服务器,一台做主机,一台做从机。写操作都在主机上执行而
读操作可以分散到主机和从机之间 。

==== 一主多从

这种场景下多台从机连到主机。这可以大幅度水平扩展系统,但代价是增加了管理成本。

==== 多主

在主/主配置下,两台服务器组合成一个链,互为主从。虽然,这种配置带来了能够在任一个系统中写数据的好处,但确实明显增加了设置、
配置和管理的复杂度。另外,除非你用MySQLCluster,否则不会有冲突检测机制以至于应用程序必须确定不去更新还没有被复制的行。也可
以用几台MySQL服务器搭成环状,得到更高水平的扩展性和性能(假设应用程序能避免向不同服务器的相同的行发送冲突的更新数据)。
MySQL5.5 引入了新的过滤特性,能够更好地处理当一台服务器正在更新复制到环中其他服务器时发生故障的情况。

image::image/4-多主环.jpg[caption="Figure 2: ", title="多主环", alt="多主环"]

当在使用多主复制的同时用了自动增长的列,你应该在每台服务器上使用auto_increment_offset和auto_increment_increment参数来确
保不会重复分配值。例如两台服务器的情况如下图所示。

image::image/4-避免自动增长冲突的参数值.jpg[caption="Figure 3: ", title="避免自动增长冲突的参数值", alt="避免自动增长冲突的参数值"]

多主一从(多源)
MySQL目前还不支持这种复制拓扑。在多主的配置下,从机基本上“为两台主机服务”,意味着从机从超过一台的主机复制变化。由于MySQL 
Cluster允许多台MySQL服务器写到同一个Cluster,因此在一些合适的应用场景,如果需要的话配置这种功能是可能的(每台MySQL服务器仅
仅是一台主机的从机)。

==== 复制模式的选择

MySQL的主-主复制架构是企业环境中常见的解决方案。此方案具备高可用、可扩展、易管理的特点。主主复制是通
过两台MySQL Server通过MySQL Replication互为主从。两台MySQL Server互相将对方作为自己的（主库）Master，自己又同时作为
对方的（备库）Slave来进行复制。实现高可用架构中的数据同步功能，下文将介绍的Keepalived实现高可用架构中的故障迁移功能。

优点::
* 数据同步写入，多点读取
* 配合Keepalived能做完善的高可用框架

缺点::
* 自动增长的列冲突(配置参数解决)
* MySQL Server数量增加时，明显增加了配置管理的复杂度(本书演示集群只有两台，复杂度可以忽略不计)

所以，我们选择 *[red]#多主(主-主)复制模式#*。